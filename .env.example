# Server Configuration
PORT=3000
HOST=0.0.0.0
BASE_DOMAIN=localhost

# Root Host Content - serve this content at the root domain
# Can be either:
#   - ArNS name (e.g., "wayfinder")
#   - Transaction ID (43-char base64url, e.g., "bNbA3TEQVL60xlgCcqdz4ZPHFZ711cZ3hmkpGttDt_U")
# Auto-detected based on format: 43-char base64url = txId, otherwise = ArNS name
# When set, visiting the root domain (e.g., permaweb.nexus/) will serve this content
# instead of the info page. The info page moves to /wayfinder/info when this is set.
# Leave empty to show the info page at root.
# Backwards compatible with ARNS_ROOT_HOST
ROOT_HOST_CONTENT=wayfinder

# Restrict to Root Host Only Mode
# When enabled:
#   - Subdomain requests are rejected with 404 (e.g., other-arns.yourdomain.com)
#   - TxId path requests are rejected with 404 (e.g., yourdomain.com/{txId})
#   - Root domain paths work normally (e.g., /, /docs, /about - paths within the content)
#   - Router management endpoints still work (/wayfinder/*)
# Requires ROOT_HOST_CONTENT to be set
RESTRICT_TO_ROOT_HOST=false

# GraphQL Proxy - proxy /graphql requests to an upstream GraphQL endpoint
# Useful for clients that need to query Arweave transaction data via the router
# Leave empty to disable (404 on /graphql)
# Example: https://arweave-search.goldsky.com/graphql
GRAPHQL_PROXY_URL=

# Mode Configuration
# proxy = fetch, verify, and serve content through the router
# route = redirect client to gateway URL (client fetches directly from gateway)
DEFAULT_MODE=proxy

# Allow mode override via query parameter
# When true, users can add ?mode=proxy or ?mode=route to override the default
# When false, the query parameter is ignored and DEFAULT_MODE is always used
ALLOW_MODE_OVERRIDE=true

# ============================================================================
# VERIFICATION SETTINGS - Determines how we verify data integrity
# ============================================================================
# When enabled, all content is verified before serving (only verified data reaches clients)
# When disabled, content is proxied directly without verification
VERIFICATION_ENABLED=true

# Where to get trusted gateways for hash verification
# top-staked = use top N staked gateways from ar.io network (RECOMMENDED for trust)
# static = use VERIFICATION_STATIC_GATEWAYS list
VERIFICATION_GATEWAY_SOURCE=top-staked

# Number of top staked gateways to use for verification (when source is 'top-staked')
# More gateways = higher trust, but slower verification
VERIFICATION_GATEWAY_COUNT=3

# Static trusted gateways for verification (when source is 'static')
VERIFICATION_STATIC_GATEWAYS=https://turbo-gateway.com,https://ardrive.net

# ArNS Consensus
# Minimum number of trusted gateways that must agree on ArNS resolution
ARNS_CONSENSUS_THRESHOLD=2

# Verification Retry Settings
# Number of different gateways to try if verification fails before returning error
# Higher = more resilient to single gateway issues, but may take longer to fail
VERIFICATION_RETRY_ATTEMPTS=3

# ============================================================================
# ROUTING SETTINGS - Determines where we fetch data from
# ============================================================================
# Routing strategy:
# fastest = concurrent ping on every request, use first responder (adds latency)
# random = random selection from healthy gateways
# round-robin = sequential rotation through gateways
# temperature = weighted selection based on recent performance + background pings (RECOMMENDED)
ROUTING_STRATEGY=temperature

# Where to get the list of gateways for routing
# network = fetch ALL gateways from ar.io registry (RECOMMENDED for availability)
# trusted-peers = fetch from gateway's /ar-io/peers endpoint
# static = use ROUTING_STATIC_GATEWAYS list only
# trusted-ario = use TRUSTED_ARIO_GATEWAYS directly (simple trusted mode)
ROUTING_GATEWAY_SOURCE=network

# Gateway to query for trusted peers list (when ROUTING_GATEWAY_SOURCE=trusted-peers)
TRUSTED_PEER_GATEWAY=https://turbo-gateway.com

# Static gateways for routing (when ROUTING_GATEWAY_SOURCE=static)
ROUTING_STATIC_GATEWAYS=https://turbo-gateway.com,https://ardrive.net,https://permagate.io

# Trusted ar.io gateways (when ROUTING_GATEWAY_SOURCE=trusted-ario)
# Simple mode: specify trusted gateways directly, bypasses network/peer discovery
# These gateways serve content AND can be used for Arweave HTTP API calls
# Leave empty to use other routing sources
TRUSTED_ARIO_GATEWAYS=

# ============================================================================
# NETWORK GATEWAY SETTINGS (shared by routing and verification network sources)
# ============================================================================
# How often to refresh the gateway list from ar.io network (milliseconds, default 24 hours)
NETWORK_GATEWAY_REFRESH_MS=86400000

# Minimum gateways required to operate (fail-safe)
NETWORK_MIN_GATEWAYS=3

# Fallback gateways if network fetch fails
NETWORK_FALLBACK_GATEWAYS=https://turbo-gateway.com,https://ardrive.net,https://permagate.io

# Resilience Settings
RETRY_ATTEMPTS=3
RETRY_DELAY_MS=100
GATEWAY_HEALTH_TTL_MS=300000
CIRCUIT_BREAKER_THRESHOLD=3
CIRCUIT_BREAKER_RESET_MS=60000
# Maximum entries in gateway health cache (prevents memory leaks with large gateway pools)
GATEWAY_HEALTH_MAX_ENTRIES=1000
# Timeout for stream reads, per-chunk (prevents zombie connections from stalling gateways)
# If no data received within this time, connection is aborted (milliseconds)
STREAM_TIMEOUT_MS=120000

# Cache Settings
ARNS_CACHE_TTL_MS=300000
# Verified content cache - stores verified Arweave content for fast repeat access
CONTENT_CACHE_ENABLED=true
# Maximum total cache size (50GB default)
CONTENT_CACHE_MAX_SIZE_BYTES=53687091200
# Maximum size for individual cached items (2GB default)
CONTENT_CACHE_MAX_ITEM_SIZE_BYTES=2147483648
# Cache storage path (empty = in-memory only, set path for disk-based cache)
CONTENT_CACHE_PATH=

# Logging
LOG_LEVEL=info

# Telemetry Settings
# Enable/disable gateway telemetry collection
TELEMETRY_ENABLED=true
# Unique identifier for this router instance
TELEMETRY_ROUTER_ID=router-1
# Sampling rate for successful requests (0.0-1.0)
TELEMETRY_SAMPLE_SUCCESS=0.1
# Sampling rate for errors (0.0-1.0, default 1.0 = all errors)
TELEMETRY_SAMPLE_ERRORS=1.0
# Sampling rate for latency measurements (0.0-1.0)
TELEMETRY_SAMPLE_LATENCY=0.1
# SQLite database path for telemetry storage
TELEMETRY_DB_PATH=./data/telemetry.db
# Days to retain telemetry data
TELEMETRY_RETENTION_DAYS=30

# Rate Limiting
# Enable/disable rate limiting (recommended for production)
RATE_LIMIT_ENABLED=false
# Time window for rate limiting (milliseconds, default 1 minute)
RATE_LIMIT_WINDOW_MS=60000
# Maximum requests per IP per window
RATE_LIMIT_MAX_REQUESTS=1000

# ============================================================================
# GATEWAY PING SETTINGS (for temperature routing strategy)
# ============================================================================
# Background ping service that periodically pings random gateways to measure
# their latency. Results are blended with actual request performance for
# smarter gateway selection. Only active when ROUTING_STRATEGY=temperature.

# Enable/disable gateway ping service
PING_ENABLED=true
# How often to refresh ping data (hours)
PING_INTERVAL_HOURS=4
# Number of random gateways to ping each round
PING_GATEWAY_COUNT=50
# Timeout for each ping request (milliseconds)
PING_TIMEOUT_MS=5000
# Maximum concurrent ping requests
PING_CONCURRENCY=10

# ============================================================================
# ERROR HANDLING SETTINGS
# ============================================================================
# Whether to exit process on unhandled promise rejection
# Recommended: true (default) - unhandled rejections indicate bugs
EXIT_ON_UNHANDLED_REJECTION=true
# Whether to exit process on uncaught exception
# Recommended: true (default) - uncaught exceptions leave process in undefined state
EXIT_ON_UNCAUGHT_EXCEPTION=true
# Grace period before forced exit to allow logs to flush (milliseconds)
EXIT_GRACE_PERIOD_MS=3000

# ============================================================================
# SHUTDOWN SETTINGS
# ============================================================================
# Grace period for in-flight requests to complete before force closing (milliseconds)
# During this time, new requests get 503, existing requests continue processing
SHUTDOWN_DRAIN_TIMEOUT_MS=15000
# Total shutdown timeout before force exit (milliseconds)
# Must be greater than SHUTDOWN_DRAIN_TIMEOUT_MS
SHUTDOWN_TIMEOUT_MS=30000

# ============================================================================
# HTTP CONNECTION POOL SETTINGS
# ============================================================================
# Connection pooling improves performance by reusing TCP connections to gateways
# Maximum connections per gateway host (default: 10)
HTTP_CONNECTIONS_PER_HOST=10
# Connection timeout (milliseconds)
HTTP_CONNECT_TIMEOUT_MS=30000
# Keep-alive timeout - how long to keep idle connections open (milliseconds)
HTTP_KEEPALIVE_TIMEOUT_MS=60000

# ============================================================================
# ARWEAVE HTTP API SETTINGS
# ============================================================================
# Enable proxying/routing of Arweave node HTTP API requests
# When enabled, endpoints like /info, /tx/{id}, /block/height/{h} are proxied to Arweave nodes
ARWEAVE_API_ENABLED=true

# Arweave nodes for GET requests (chain state, tx info, blocks)
# These are actual Arweave mining/full nodes, separate from ar.io gateways
# Note: ar.io gateways also serve Arweave HTTP APIs, so you can use those too
ARWEAVE_READ_NODES=http://tip-1.arweave.xyz:1984,http://tip-2.arweave.xyz:1984,http://tip-3.arweave.xyz:1984,http://tip-4.arweave.xyz:1984,http://tip-5.arweave.xyz:1984

# Arweave nodes for POST requests (transaction submission, chunks)
# These should be well-connected nodes for reliable propagation
# Falls back to ARWEAVE_READ_NODES if not set
ARWEAVE_WRITE_NODES=

# Cache settings for Arweave API responses
ARWEAVE_API_CACHE_ENABLED=true
# TTL for immutable data (transactions, blocks) - 24 hours default
ARWEAVE_API_CACHE_IMMUTABLE_TTL_MS=86400000
# TTL for dynamic data (info, balances, status) - 30 seconds default
ARWEAVE_API_CACHE_DYNAMIC_TTL_MS=30000
# Maximum cache entries
ARWEAVE_API_CACHE_MAX_ENTRIES=10000
# Maximum cache size in bytes (100MB default)
ARWEAVE_API_CACHE_MAX_SIZE_BYTES=104857600

# Retry settings for Arweave node requests
ARWEAVE_API_RETRY_ATTEMPTS=3
ARWEAVE_API_RETRY_DELAY_MS=100
# Request timeout (milliseconds)
ARWEAVE_API_TIMEOUT_MS=30000

# ============================================================================
# ADMIN UI SETTINGS
# ============================================================================
# The admin UI runs on a separate port from the public router for security.
# By default it binds to 127.0.0.1 (localhost only) â€” use SSH tunnel for remote access.

# Enable/disable the admin UI server
ADMIN_UI_ENABLED=true

# Admin UI port (must be different from PORT)
ADMIN_PORT=3001

# Admin UI bind address
# 127.0.0.1 = localhost only (default, most secure)
# 0.0.0.0 = all interfaces (requires ADMIN_TOKEN to be set)
ADMIN_HOST=127.0.0.1

# Authentication token for admin UI (required when ADMIN_HOST is not localhost)
# When set, the UI prompts for this token on load
# Generate with: openssl rand -base64 32
ADMIN_TOKEN=

# ============================================================================
# CONTENT MODERATION SETTINGS
# ============================================================================
# Enable content moderation (blocking of ArNS names and transaction IDs)
MODERATION_ENABLED=false

# Path to blocklist JSON file (created automatically if doesn't exist)
# The file is watched for changes and hot-reloaded without restart
MODERATION_BLOCKLIST_PATH=./data/blocklist.json

# Admin API token for moderation endpoints (required if moderation enabled)
# Use a strong, random token (e.g., generate with: openssl rand -base64 32)
# Endpoints: POST /wayfinder/moderation/block, DELETE /wayfinder/moderation/block/:type/:value, etc.
MODERATION_ADMIN_TOKEN=
