# Server Configuration
PORT=3000
HOST=0.0.0.0
BASE_DOMAIN=localhost

# ArNS Root Host - serve this ArNS name at the root domain
# When set, visiting the root domain (e.g., permaweb.nexus/) will serve content
# from this ArNS name instead of the info page.
# The info page moves to /wayfinder/info when this is set.
# Leave empty to show the info page at root.
ARNS_ROOT_HOST=wayfinder

# Mode Configuration
# proxy = fetch, verify, and serve content
# route = redirect to gateway URL
DEFAULT_MODE=proxy
ALLOW_MODE_OVERRIDE=true

# ============================================================================
# VERIFICATION SETTINGS - Determines how we verify data integrity
# ============================================================================
# When enabled, all content is verified before serving (only verified data reaches clients)
# When disabled, content is proxied directly without verification
VERIFICATION_ENABLED=true

# Where to get trusted gateways for hash verification
# top-staked = use top N staked gateways from ar.io network (RECOMMENDED for trust)
# static = use VERIFICATION_STATIC_GATEWAYS list
VERIFICATION_GATEWAY_SOURCE=top-staked

# Number of top staked gateways to use for verification (when source is 'top-staked')
# More gateways = higher trust, but slower verification
VERIFICATION_GATEWAY_COUNT=3

# Static trusted gateways for verification (when source is 'static')
VERIFICATION_STATIC_GATEWAYS=https://turbo-gateway.com,https://ardrive.net

# ArNS Consensus
# Minimum number of trusted gateways that must agree on ArNS resolution
ARNS_CONSENSUS_THRESHOLD=2

# ============================================================================
# ROUTING SETTINGS - Determines where we fetch data from
# ============================================================================
# Routing strategy:
# fastest = concurrent ping on every request, use first responder (adds latency)
# random = random selection from healthy gateways
# round-robin = sequential rotation through gateways
# temperature = weighted selection based on recent performance + background pings (RECOMMENDED)
ROUTING_STRATEGY=temperature

# Where to get the list of gateways for routing
# network = fetch ALL gateways from ar.io registry (RECOMMENDED for availability)
# trusted-peers = fetch from gateway's /ar-io/peers endpoint
# static = use ROUTING_STATIC_GATEWAYS list only
ROUTING_GATEWAY_SOURCE=network

# Gateway to query for trusted peers list (when ROUTING_GATEWAY_SOURCE=trusted-peers)
TRUSTED_PEER_GATEWAY=https://turbo-gateway.com

# Static gateways for routing (when ROUTING_GATEWAY_SOURCE=static)
ROUTING_STATIC_GATEWAYS=https://turbo-gateway.com,https://ardrive.net,https://permagate.io

# ============================================================================
# NETWORK GATEWAY SETTINGS (shared by routing and verification network sources)
# ============================================================================
# How often to refresh the gateway list from ar.io network (milliseconds, default 24 hours)
NETWORK_GATEWAY_REFRESH_MS=86400000

# Minimum gateways required to operate (fail-safe)
NETWORK_MIN_GATEWAYS=3

# Fallback gateways if network fetch fails
NETWORK_FALLBACK_GATEWAYS=https://turbo-gateway.com,https://ardrive.net,https://permagate.io

# Resilience Settings
RETRY_ATTEMPTS=3
RETRY_DELAY_MS=100
GATEWAY_HEALTH_TTL_MS=300000
CIRCUIT_BREAKER_THRESHOLD=3
CIRCUIT_BREAKER_RESET_MS=60000
# Maximum entries in gateway health cache (prevents memory leaks with large gateway pools)
GATEWAY_HEALTH_MAX_ENTRIES=1000
# Timeout for stream reads, per-chunk (prevents zombie connections from stalling gateways)
# If no data received within this time, connection is aborted (milliseconds)
STREAM_TIMEOUT_MS=120000

# Cache Settings
ARNS_CACHE_TTL_MS=300000
# Verified content cache - stores verified Arweave content for fast repeat access
CONTENT_CACHE_ENABLED=true
# Maximum total cache size (50GB default)
CONTENT_CACHE_MAX_SIZE_BYTES=53687091200
# Maximum size for individual cached items (2GB default)
CONTENT_CACHE_MAX_ITEM_SIZE_BYTES=2147483648
# Cache storage path (empty = in-memory only, set path for disk-based cache)
CONTENT_CACHE_PATH=

# Logging
LOG_LEVEL=info

# Telemetry Settings
# Enable/disable gateway telemetry collection
TELEMETRY_ENABLED=true
# Unique identifier for this router instance
TELEMETRY_ROUTER_ID=router-1
# Sampling rate for successful requests (0.0-1.0)
TELEMETRY_SAMPLE_SUCCESS=0.1
# Sampling rate for errors (0.0-1.0, default 1.0 = all errors)
TELEMETRY_SAMPLE_ERRORS=1.0
# Sampling rate for latency measurements (0.0-1.0)
TELEMETRY_SAMPLE_LATENCY=0.1
# SQLite database path for telemetry storage
TELEMETRY_DB_PATH=./data/telemetry.db
# Days to retain telemetry data
TELEMETRY_RETENTION_DAYS=30

# Rate Limiting
# Enable/disable rate limiting (recommended for production)
RATE_LIMIT_ENABLED=false
# Time window for rate limiting (milliseconds, default 1 minute)
RATE_LIMIT_WINDOW_MS=60000
# Maximum requests per IP per window
RATE_LIMIT_MAX_REQUESTS=1000

# ============================================================================
# GATEWAY PING SETTINGS (for temperature routing strategy)
# ============================================================================
# Background ping service that periodically pings random gateways to measure
# their latency. Results are blended with actual request performance for
# smarter gateway selection. Only active when ROUTING_STRATEGY=temperature.

# Enable/disable gateway ping service
PING_ENABLED=true
# How often to refresh ping data (hours)
PING_INTERVAL_HOURS=4
# Number of random gateways to ping each round
PING_GATEWAY_COUNT=50
# Timeout for each ping request (milliseconds)
PING_TIMEOUT_MS=5000
# Maximum concurrent ping requests
PING_CONCURRENCY=10

# ============================================================================
# ERROR HANDLING SETTINGS
# ============================================================================
# Whether to exit process on unhandled promise rejection
# Recommended: true (default) - unhandled rejections indicate bugs
EXIT_ON_UNHANDLED_REJECTION=true
# Whether to exit process on uncaught exception
# Recommended: true (default) - uncaught exceptions leave process in undefined state
EXIT_ON_UNCAUGHT_EXCEPTION=true
# Grace period before forced exit to allow logs to flush (milliseconds)
EXIT_GRACE_PERIOD_MS=3000

# ============================================================================
# SHUTDOWN SETTINGS
# ============================================================================
# Grace period for in-flight requests to complete before force closing (milliseconds)
# During this time, new requests get 503, existing requests continue processing
SHUTDOWN_DRAIN_TIMEOUT_MS=15000
# Total shutdown timeout before force exit (milliseconds)
# Must be greater than SHUTDOWN_DRAIN_TIMEOUT_MS
SHUTDOWN_TIMEOUT_MS=30000

# ============================================================================
# HTTP CONNECTION POOL SETTINGS
# ============================================================================
# Connection pooling improves performance by reusing TCP connections to gateways
# Maximum connections per gateway host (default: 10)
HTTP_CONNECTIONS_PER_HOST=10
# Connection timeout (milliseconds)
HTTP_CONNECT_TIMEOUT_MS=30000
# Keep-alive timeout - how long to keep idle connections open (milliseconds)
HTTP_KEEPALIVE_TIMEOUT_MS=60000
